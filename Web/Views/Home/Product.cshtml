@model Product
@section Css{


}
    <div class="row productDetail">
        <div class="col s12 l3 m3">
            <div class="productGallery">
                <div class="mainImg" id="img-container">
                    <img src="/tema/images/upload/@Model.Gallery.First().Image" data-zoom-image="/tema/images/upload/@Model.Gallery.First().Image" data-fancybox />
                </div>
                <div id="mainGallery" class="gallery">
                @foreach (var item in Model.Gallery)
                {
                    if (!item.Mobile)
                    {
                        <div class="thumbImage">
                            <a href="#" data-image="/tema/images/upload/@item.Image" data-zoom-image="/tema/images/upload/@item.Image">
                                <img src="~/tema/images/upload/@item.Image" />
                            </a>
                        </div>
                    }

                }
            </div>
        </div>
    </div>
    <div class="col s12 l9 m9">
        <div class="productAddCartDetail">
            <h1>@Model.Title</h1>
            @{
                string priceStrike = "";
                if (Model.DiscountPrice != null && Model.DiscountPrice != 0)
                {
                    priceStrike = "priceStrike";
                }
            }
            <div class="productPrice">
                <span class="price @priceStrike">@Model.Price.ToString("C") </span>
                @if (Model.DiscountPrice != null && Model.DiscountPrice != 0)
                {
                    <span class="priceDiscount">@Convert.ToDecimal(Model.DiscountPrice).ToString("C") </span>
                }
            </div>
            <hr />
            <div class="productAddsetting">
                <div class="col s12 l12 m12">
                    <span>Adet:</span>
                    <div class="plusMinus">
                        <a href="javascript:void(0)" class="minus"><i class="fa-solid fa-minus"></i></a>
                        <input type="number" name="Piece" class="browser-default" value="1" />
                        <a href="javascript:void(0)" class="plus"><i class="fa-solid fa-plus"></i></a>
                    </div>
                    <input type="button" name="AddToCart" value="SEPETE EKLE" class="AddToCart" />
                    <input type="button" name="BuyNow" value="HEMEN AL" class="BuyNow" />
                    <a href="javascript:(void)" class="addFavorite"><i class="fa-regular fa-heart"></i> Favorilere Ekle!</a>
                </div>
                <div class="clearfix"></div>
                <div class="addtoBasketMessage"></div>
                <div class="clearfix"></div>
                <div class="explanation">
                    <div class="text">
                        <span>Ürün Açıklaması</span>
                        @Html.Raw(Model.Explanation)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col s12 l12 m12">
        <div class="productList randomProduct">
            <h2>İlginizi Çekebilecek Ürünler</h2>
            @{
                List<Product> randomProduct = (List<Product>)ViewBag.RandomProduct;
            }

            @foreach (var item in randomProduct)
            {
                <div class="col s12 l3 m6">
                    <div class="listProductBox randombox">
                        <div class="productImage">
                            <img src="~/tema/images/upload/@item.FeaturedImage" />
                        </div>
                        <span class="title">@item.Title</span>
                        @{
                            string randomPriceStrike = "";
                            if (item.DiscountPrice != null && item.DiscountPrice != 0)
                            {
                                randomPriceStrike = "priceStrike";
                            }
                        }
                        <span class="price @randomPriceStrike">@item.Price TL</span>
                        @if (item.DiscountPrice != null && item.DiscountPrice != 0)
                        {
                            <span class="priceDiscount">@item.DiscountPrice TL</span>
                        }
                        <a href="/urun/@item.SeoUrl" title="@item.Title"><i class="fa-solid fa-cart-arrow-down"></i> Sepete Ekle</a>
                    </div>
                </div>
            }
            <div class="clearfix"></div>
        </div>
    </div>
</div>
@section Scripts{
    <script src="~/tema/js/jquery.elevatezoom.min.js"></script>
    <script>

        $(document).ready(function () {

            $(".addtoBasketMessage").hide();

            $(".mainImg img").elevateZoom({ gallery: 'mainGallery', cursor: 'pointer', galleryActiveClass: 'active' });

            Fancybox.bind("[data-fancybox]", {
                // Your options go here
            });
        });

        $(".plus").click(function () {

            var piece = $("[name='Piece']").val();

            piece++;

            $("[name='Piece']").val(piece);

        });

        $(".minus").click(function () {

            var piece = $("[name='Piece']").val();

            piece--;

            if (piece <= 1) {
                $("[name='Piece']").val(1);
            } else {
                $("[name='Piece']").val(piece);
            }
        })

        $("[name='AddToCart']").click(function () {

            var piece = $("[name='Piece']").val();

            addToBasket("addToBasket", piece);

        })

        $("[name='BuyNow']").click(function () {

            var piece = $("[name='Piece']").val();

            addToBasket("buyNow", piece);

        })

        function addToBasket(situation, piece) {
            fetch("/Home/AddToBasket?situation=" + situation + "&product=" + @Model.Id+"&piece=" + piece, {
                method: "post"
            })
                .then(r => r.text())
                .then(r => {
                    $(".addtoBasketMessage").show();
                    if (r == "1") {
                        $(".addtoBasketMessage").html(piece + " Ürün sepetinize eklendi. Sepete ulaşmak için <a href='/sepet'>BURAYI</a> tıklayınız.");
                        cartcount();
                    } else if (r == "buyNow") {
                        location = "/sepet";
                    } else {
                        $(".addtoBasketMessage").html("Sepete eklerken bir sorun oluştu. Mesaj: " + r);
                    }
                })
        }

    </script>

}